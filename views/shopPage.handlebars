<body>
    <main>
        <h1>{{shop.name}}</h1>
        {{#if loggedIn}}
        {{#if inBookmarks}}
        <form action="/shop/{{shop._id}}" method="POST" id="bookmark">
            <button type="submit" class="unbook">Un-bookmark</button>
        </form>
        {{else}}
        <form action="/shop/{{shop._id}}" method="POST" id="bookmark">
            <button type="submit" class="book">Bookmark</button>
        </form>
        {{/if}}
        {{#if Default}}
        <form action="/shop/{{shop._id}}/flagForm" method="GET" id="flag">
            <button type="submit" class="flag">Flag Shop</button>
        </form>
        {{/if}}
        {{/if}}
        {{#if flagged}}
        <h2>This Shop has been flagged {{flagcount}} times</h2>
        {{/if}}
        <h2>Details:</h2>
        <ul>
            <li>
                <p>Address: {{shop.address}}</p>
            </li>
            <li>
                <p>Website: <a href="{{shop.website}}" target="_blank">{{shop.website}}</a></p>
            </li>
            <li>
                <p>Phone Number: {{shop.phoneNumber}}</p>
            </li>
            <li>
                <p>Average Rating: {{shop.averageRating}}</p>
            </li>
            <li>
                <p>Number of Likes: {{shop.numOfLikes}}</p>
            </li>
            <li>
                <p id="serviceHours"></p>
            </li>
            <script>
                let openTime = "{{shop.openTime}}"
                let closeTime = "{{shop.closeTime}}"
                let openDate = new Date(openTime)
                let closeDate = new Date(closeTime)
                let openHour = openDate.getHours()
                let closeHour = closeDate.getHours()
                let openMin = openDate.getMinutes()
                let closeMin = closeDate.getMinutes()
                let AMORPM1 = "PM"
                let AMORPM2 = "PM"
                let OpenOrClose
                let canEnter = "Open"
                if(closeHour < openHour){
                    OpenOrClose = closeHour + 24     
                }
                else{
                    OpenOrClose = closeHour
                }
                if({{currentHour}} >= openHour && {{currentHour}} <= OpenOrClose){
                    if({{currentHour}} === openHour){
                        if({{currentMin}} >= openMin){
                            canEnter = "Open"
                        }
                        else{
                            canEnter = "Closed" 
                        }
                    }
                    else{
                        canEnter = "Open"
                    }
                    if({{currentHour}} === OpenOrClose){
                        if({{currentMin}} <= closeMin){
                            canEnter = "Open"
                        }
                        else{
                            canEnter = "Closed" 
                        }
                    }
                    else{
                        canEnter = "Open" 
                    }
                }
                else{
                    canEnter = "Closed" 
                }
                if(openHour < 12){
                    AMORPM1 = "AM"
                    if(openHour === 0){
                        openHour = 12
                    }
                }
                else{
                    if(openHour === 12){
                        openHour = 12
                    }
                    else{
                        openHour = openHour-12
                    }
                }
                if(closeHour < 12){
                    AMORPM2 = "AM"
                    if(closeHour === 0){
                        closeHour = 12
                    }
                }
                else{
                    if(closeHour === 12){
                        closeHour = 12
                    }
                    else{
                        closeHour = closeHour-12
                    }
                }
                if(openHour < 10){
                    openHour = '0'+openHour.toString()
                }
                if(closeHour < 10){
                    closeHour = '0'+closeHour.toString()
                }
                if(openMin < 10){
                    openMin = '0'+openMin.toString()
                }
                if(closeMin < 10){
                    closeMin = '0'+closeMin.toString()
                }
                document.getElementById("serviceHours").innerText = "Service Hours: " + openHour + ":" + openMin + AMORPM1 + " - " + closeHour + ":" + closeMin + AMORPM2 + " " + canEnter;
            </script>
        </ul>
        <h2>Menu:</h2>
        {{#if loggedIn}}
        {{#if noOwner}}
        {{#if Default}}
        <a href="/shop/{{shop._id}}/itemForm">Add an item</a><br>
        {{/if}}
        {{else}}
        {{#if isOwner}}
        <a href="/shop/{{shop._id}}/itemForm">Add an item</a><br>
        {{/if}}
        {{/if}}
        {{/if}}
        <button onclick="toggleContent('toggledMenu')">Display Menu</button>
        <div id="toggledMenu" style="display: none;">
            <table>
                <tr>
                    <th>Item </th>
                    <th>Price </th>
                    <th>Page Link</th>
                </tr>
                {{#each items}}
                <tr>
                    <td>{{this.name}}</td>
                    <td>{{this.price}}</td>
                    <td><a href="/item/{{this._id}}">Page</a></td>
                </tr>
                {{/each}}
            </table>
        </div>
        <h2>Reviews:</h2>
        {{#if loggedIn}}
        {{#if Default}}
        <div id="container">
            <form action="/shop/{{shop._id}}/reviewForm" method="POST" id="reviewForm">
                <label for="title">
                    Review Title:
                    <input id="title" name="title" type="text">
                </label>
                <br>
                <label for="rating">
                    Rating:
                    <input type="range" value="0" min="1" max="5" name="rating" id="rating"
                        oninput="this.nextElementSibling.value = this.value">
                    <output>1</output>
                </label>
                <br>
                <label for="review">
                    <textarea id="review" name="review" placeholder="Write a Review..."></textarea>
                </label>
                <br>
                <button type="submit" id="submitButton" name="submitButton" class="save">Create Review</button>
            </form>
        </div>
        {{/if}}
        {{/if}}
        <button onclick="toggleContent('toggledReviews')">Display Reviews</button>
        <div id="toggledReviews" style="display: none;">
            <select id="reviewSort" name="reviewSort" onchange="reviewSort(this.value)">
                <option value='highest'>By Most Positive</option>
                <option value='lowest'>By Most Negative</option>
                <option value='newest'>By Newest</option>
                <option value='oldest'>By Oldest</option>
            </select>
            <ul id="oldest">
                {{#each reviews}}
                <div>
                    <h3><a href="/review/{{this._id}}">{{this.title}}</a></h3>
                    <p>Rating: {{this.rating}}/5</p>
                    <p>Posted by: {{this.user}}</p>
                    <p>Posted on: {{this.reviewDate}}</p>
                </div>
                {{/each}}
            </ul>
            <ul id="newest" hidden>
                {{#each newestReviews}}
                <div>
                    <h3><a href="/review/{{this._id}}">{{this.title}}</a></h3>
                    <p>Rating: {{this.rating}}/5</p>
                    <p>Posted by: {{this.user}}</p>
                    <p>Posted on: {{this.reviewDate}}</p>
                </div>
                {{/each}}
            </ul>
            <ul id="highest" hidden>
                {{#each highestReviews}}
                <div>
                    <h3><a href="/review/{{this._id}}">{{this.title}}</a></h3>
                    <p>Rating: {{this.rating}}/5</p>
                    <p>Posted by: {{this.user}}</p>
                    <p>Posted on: {{this.reviewDate}}</p>
                </div>
                {{/each}}
            </ul>
            <ul id="lowest" hidden>
                {{#each lowestReviews}}
                <div>
                    <h3><a href="/review/{{this._id}}">{{this.title}}</a></h3>
                    <p>Rating: {{this.rating}}/5</p>
                    <p>Posted by: {{this.user}}</p>
                    <p>Posted on: {{this.reviewDate}}</p>
                </div>
                {{/each}}
            </ul>
        </div>
        <footer>
            <a href="javascript:history.back()" class="static-link">Go Back to Stores</a>
            {{#if loggedIn}}

            <hr>
            <form action="/shop/{{shop._id}}/delete" method="POST">
                <button type="submit" class="delete">DELETE SHOP</button>
            </form>
            {{/if}}
        </footer>
    </main>
</body>